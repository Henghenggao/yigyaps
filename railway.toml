# ─────────────────────────────────────────────────────────────────────────────
# YigYaps Railway Configuration
# ─────────────────────────────────────────────────────────────────────────────
#
# This configuration defines how Railway builds and runs the YigYaps API.
# Railway automatically detects this file and uses it for deployment.
#
# Services:
#   1. yigyaps-api (this service)
#   2. PostgreSQL database (created separately in Railway dashboard)
#
# License: Apache 2.0
# ─────────────────────────────────────────────────────────────────────────────

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"
watchPatterns = ["packages/**"]

[deploy]
healthcheckPath = "/v1/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[deploy.environmentVariables]]
name = "NODE_ENV"
value = "production"

[[deploy.environmentVariables]]
name = "LOG_LEVEL"
value = "info"

[[deploy.environmentVariables]]
name = "YIGYAPS_API_URL"
value = "https://api.yigyaps.com"

[[deploy.environmentVariables]]
name = "CORS_ORIGIN"
# IMPORTANT: Set this in Railway dashboard with your actual domains (comma-separated, no trailing slash).
# Example: https://yigyaps.com,https://www.yigyaps.com
# Using "*" breaks the CSRF origin check and blocks all browser POST requests.
# Dashboard variable takes precedence over this value.
value = "https://yigyaps.com,https://www.yigyaps.com"

# NOTE: DATABASE_URL is automatically injected by Railway when you link the PostgreSQL service
# NOTE: ADMIN_SECRET should be set in Railway dashboard as a secret variable
